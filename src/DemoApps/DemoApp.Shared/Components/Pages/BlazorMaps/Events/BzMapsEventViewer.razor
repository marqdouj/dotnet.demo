@using Marqdouj.DotNet.AzureMaps.Blazor.Models.Events
@inject IJSRuntime JSRuntime

<div style="@style">
    <FluentDataGrid Items="@Events.Items.AsQueryable()"
                    TGridItem="MapEventArgsViewModel"
                    GenerateHeader="@GenerateHeaderOption.Sticky"
                    RowStyle="@rowStyle"
                    MultiLine="@Mulitline"
                    ResizableColumns="true"
                    AutoFit="true">
        <ChildContent>
            <PropertyColumn Property="@(p => p.Args.Type)" />
            <PropertyColumn Property="@(p => p.Args.Target)" />
            <PropertyColumn Property="@(p => p.TimeStamp)" />
            <PropertyColumn Property="@(p => p.Value)" />
            <TemplateColumn Title="Value">
                <FluentButton Appearance="Appearance.Accent" @onclick="@(() => CopyToClipboard(context))">Copy</FluentButton>
            </TemplateColumn>

        </ChildContent>
        <EmptyContent />
    </FluentDataGrid>
</div>

<script>
    function copyClipboard(text) {
        navigator.clipboard.writeText(text).then(() => {
            alert("Text copied to clipboard");
        }).catch(err => {
            alert("Failed to copy text to clipboard");
            console.error("Failed to copy text: ", err);
        });
    }
</script>
@code {
    private string style => $"height:{Height ?? "200px"};width:{Width ?? "100%"};overflow:auto;border:groove;border-width:1";
    private Func<MapEventArgsViewModel, string?> rowStyle = x => GetRowStyle(x);

    [Parameter, EditorRequired]
    public MapEventArgsViewModelManager Events { get; set; }

    [Parameter]
    public string? Height { get; set; }

    [Parameter]
    public bool Mulitline { get; set; }

    [Parameter]
    public string? Width { get; set; }

    private static string? GetRowStyle(MapEventArgsViewModel item)
    {
        switch (item.Args.Type)
        {
            case MapEventType.Error:
                return "background-color: palevioletred";
            case MapEventType.Ready:
                return "background-color: lightgreen";
            default:
                return null;
        }
    }

    private async Task CopyToClipboard(MapEventArgsViewModel item)
    {
        await JSRuntime.InvokeVoidAsync("copyClipboard", item.Value);
    }
}
